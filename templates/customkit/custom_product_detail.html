{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
 <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="MediaCenter, Template, eCommerce">
    <meta name="robots" content="all">
    <title>{% block title %}{{single_product.product_name}}{% endblock title %} - WaseemInt</title>
    <link rel="shortcut icon" href="{% static 'assets/images/wlogo.png' %}" type="image/x-icon">

    <!-- Preconnect for Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>



    <!-- Load CSS Files -->
    <link rel="stylesheet" href="{% static 'assets/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/main.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/blue.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/bootstrap-select.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/font-awesome.css' %}">
    <link rel="stylesheet" href="{% static 'custom/css/jquery.miniColors.css' %}" />
    <link rel="stylesheet" href="{% static 'custom/css/jquery.simplecolorpicker.css' %}" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css" />

    <!-- Load JavaScript Files -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js" integrity="sha512-CeIsOAsgJnmevfCi2C7Zsyy6bQKi43utIjdA87Q0ZY84oDqnI0uwfM9+bKiIkI75lUeI00WG/+uJzOmuHlesMA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script type="text/javascript" src="{% static 'custom/js/tshirtEditor.js' %}"></script>
    <script type="text/javascript" src="{% static 'custom/js/jquery.miniColors.min.js' %}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

<style>
    ul.nav{
        list-style: none;
        display: flex;
        flex-wrap: wrap;
    }
    .color-preview {
	      	border: 1px solid #CCC;
	      	margin: 2px;
	      	zoom: 1.5;
	      	vertical-align: top;
	      	display: inline-block;
	      	cursor: pointer;
	      	overflow: hidden;
	      	width: 20px;
	      	height: 20px;
            display: inline-block;
            margin-right: 1px;
	      }

</style>

</head>
<body >
{% include "includes/navbar.html" %}

<style>
	/* Styles for the WhatsApp icon */
	.whatsapp-icon {
	  position: fixed;
	  bottom: 20px; /* Adjust as needed */
	  right: 20px; /* Adjust as needed */
	  z-index: 9999; /* Ensure it's above other content */
	}

	.whatsapp-icon i {
	  font-size: 40px; /* Adjust icon size as needed */
	  color: #25d366; /* WhatsApp icon color */
	}
  </style>
  <a href="https://wa.me/923016543034" class="whatsapp-icon" target="_blank">
	<i class="fa fa-whatsapp"></i>
  </a>


<br>
<style>
    .ownlogoc{
        width: 100%;
        border: 2px solid black;
        padding: 10px;
        text-align: center;
        cursor: pointer;

    }
    .ownlogoc:hover{

        background-color: black;
        color: white;
    }
    .ownlogoc:active{
    background-color: #ccc;
    color: #000;
    }
    #text .btn {
    margin-bottom: 10px;
    }

    .modal-dialog {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: calc(100% - 60px);
    }
    .modal-content {
    width: 100%;
    max-width: 600px;
    }
    #cropImage {
    max-width: 100%;
    }

</style>

<div id="cropModal" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">Crop Image</h4>
            </div>
            <div class="modal-body">
                <img id="cropImage" class="img-responsive" src="" alt="Crop Image">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="cropImageButton">Crop</button>
            </div>
        </div>
    </div>
</div>



<div class="container my-5">
    <h1 class="">{{single_product.product_name}}</h1>
</div>
<br><br>

<div class="container">
    <div class="row g-5">
        <div class="col-md-3 col-12">
            <div class="">

<style>
.nav-tabs {
            overflow-x: auto;
            overflow-y: hidden; /* Hide y-axis scrollbar */
            white-space: nowrap;
            display: flex;
            -webkit-overflow-scrolling: touch;
            border-bottom: none;
        }

        .nav-tabs>li {
            float: none;
            display: inline-block;
        }

        .nav-tabs>li>a {
            white-space: nowrap;
            display: flex;
            align-items: center;
        }

        .nav-tabs::-webkit-scrollbar {
            height: 6px;
        }

        .nav-tabs::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 3px;
        }

        .nav-tabs::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        .nav-tabs::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
</style>

                <div class="panel panel-deafult">
                <ul class="nav nav-tabs">
                  <li class="active"><a href="#shirtcolor" data-toggle="tab"> Color</a></li>
                  <li><a href="#logos" data-toggle="tab">Logos</a></li>
                  <li><a href="#text" data-toggle="tab">Text</a></li>
                  <li><a href="#shapes" data-toggle="tab">Shapes</a></li>
                  <li><a href="#mockups" data-toggle="tab">Mockups</a></li>
                  <li><a href="#designs" data-toggle="tab">Designs</a></li>
                  <li><a href="#pattern" data-toggle="tab">Pattern</a></li>
                </ul>
            </div>
              <div class="tab-content ">

                <div id="shirtcolor" class="tab-pane fade in active">
                    <div class="well">


                        <label>
                            <input type="radio" name="colorType" value="plain" checked> Plain Color
                        </label>
                        <label>
                            <input type="radio" name="colorType" value="gradient"> Gradient Color
                        </label>

                        <div id="plainColorOptions">
                            <ul class="nav">
                                <li class="color-preview" title="White" style="background-color:#ffffff;"></li>
                                <li class="color-preview" title="Black" style="background-color:#1f1e1e;"></li>
                                {% for i in colors %}
                                    <li class="color-preview" title="{{i.color}}" style="background-color:{{i.color}};"></li>
                                {% endfor %}

                            </ul>
                        </div>

                        <div id="gradientColorOptions" style="display: none;">
                            <label for="gradientType">Gradient Type:</label>
                            <select id="gradientType" class="form-control" name="gradientType">
                                <option value="linear">Linear</option>
                                <option value="radial">Radial</option>
                            </select>

                            <label for="numGradientColors">Number of Gradient Colors:</label>
                            <select id="numGradientColors" class="form-control" name="numGradientColors">
                                <option value="2">2 Colors</option>
                                <option value="3">3 Colors</option>
                                <option value="4">4 Colors</option>
                            </select>

                            <div id="gradientColorInputs">
                                <label for="gradientStart">Start Color:</label>
                                <input type="color" class="form-control gradient-color-input" id="gradientStart" name="gradientStart" value="#ffffff">

                                <label for="gradientEnd">End Color:</label>
                                <input type="color" class="form-control gradient-color-input" id="gradientEnd" name="gradientEnd" value="#1f1e1e">
                            </div>

                            <label for="gradientDirection">Direction:</label>
                            <select id="gradientDirection" class="form-control" name="gradientDirection">
                                <option value="to right">Left to Right</option>
                                <option value="to left">Right to Left</option>
                                <option value="to bottom">Top to Bottom</option>
                                <option value="to top">Bottom to Top</option>
                                <option value="custom">Custom (Degrees)</option>
                            </select>

                            <div id="degreeInputContainer" style="display: none;">
                                <label for="gradientDegree">Enter Degrees:</label>
                                <input type="number" class="form-control" id="gradientDegree" name="gradientDegree" value="0" min="0" max="360">
                            </div>
                        </div>
                    </div>
                </div>








                <div id="logos" class="tab-pane fade">
                    <div class="well">
                            <div>
                                <span style="font-weight: bold;">Please Uplaod only One Logo in Hight Resoulation for better Result</span>
                                <label for="ownlogo" class="ownlogoc" >Upload Your Own Logo</label>
                                <input style="display:none;" id="ownlogo"  accept="image/*" type="file" onchange="uploadLogo(event)">
                            </div>
                            <hr>
                            <label for="opacity-slider" id="opacity-slider-label">Opacity:</label>
                            <input type="range" id="opacity-slider" min="0" max="1" step="0.01" value="1">

                            <hr>

                        <div id="avatarlist" style="height: 365px;overflow: auto;">
                            {% for logo in custom_logo %}
                            <img style="cursor:pointer;height: 86px;width: 86px;margin-left: 10px;margin-bottom: 10px;" class="img-polaroid" src="{{logo.image.url}}">
                            {% endfor %}
                        </div>

                    </div>
                </div>

                <div id="text" class="tab-pane fade">
                    <div class="well">
                        <div class="input-group">
                            <textarea class="form-control" style="padding: 18px;" id="text-string" type="text" placeholder="Add text here..."></textarea>
                            <span class="input-group-btn">
                                <button id="add-text" class="btn btn-default" type="button" title="Add text">Add</button>
                            </span>
                        </div>
                        <hr>
                        <button style="margin: 2px;background: transparent;border: 1px solid gainsboro;" id="align-left-text" title="Align Left"><img height="25" width="25" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAXUlEQVR4nO3WwQkAMQgEQPtveq+AfD0SZQbyd1mIVsHvMvQdbg8kyNpGAGbJlm80gpRGYkMD5IGlmI6L4PZAgqxtBGCWbPlGI0hpJDY0QB5Yium4CG4PJMjaRqD6fCcVJQZ9Gl14AAAAAElFTkSuQmCC"></button>
                        <button style="margin: 2px;background: transparent;border: 1px solid gainsboro;" id="align-right-text" title="Align Right"><img height="25" width="25" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAWElEQVR4nO3VwQkAMQwDsOy/tG+AfnuUuhLkH2NIZuB3uXQWpxcSpLYRgDek5fxGkNFIfHagRy6dxemFBKltBOANaTm/EWQ0Ep8d6JFLZ3F6IUFqG4HZ5wNbzSUGz+oQgAAAAABJRU5ErkJggg=="></button>
                        <button style="margin: 2px;background: transparent;border: 1px solid gainsboro;" id="align-center-text" title="Align Center"><img height="25" width="25" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAWElEQVR4nO3VwQkAMQwDsOy/tG+AfnuUuhLkH2NIZuB3uXQWpxcSpLYRgB5pObERZDQS3xt4Qy6dxemFBKltBKBHWk5sBBmNxPcG3pBLZ3F6IUFqG4HZ5wNBcSUGoVfKQQAAAABJRU5ErkJggg=="></button>

                        <div class="input-group">
                            <label for="line-height">Line Height:</label>
                            <input id="line-height" type="number" step="0.1" min="0" placeholder="Line Height">
                        </div>

                        <div class="input-group">
                            <label for="word-spacing">Word Spacing:</label>
                            <input id="word-spacing" type="number" step="0.1" min="0" placeholder="Word Spacing">
                        </div>
                        <script>


                            // Function to align text left
document.getElementById('align-left-text').addEventListener('click', function() {
var activeObject = canvas.getActiveObject();
if (activeObject && activeObject.type === 'text') {
    activeObject.set('textAlign', 'left');
    canvas.renderAll();
    saveState();
}
});

// Function to align text right
document.getElementById('align-right-text').addEventListener('click', function() {
var activeObject = canvas.getActiveObject();
if (activeObject && activeObject.type === 'text') {
    activeObject.set('textAlign', 'right');
    canvas.renderAll();
    saveState();
}
});

// Function to align text center
document.getElementById('align-center-text').addEventListener('click', function() {
var activeObject = canvas.getActiveObject();
if (activeObject && activeObject.type === 'text') {
    activeObject.set('textAlign', 'center');
    canvas.renderAll();
    saveState();
}
});
// Update text properties when input values change
document.getElementById('line-height').addEventListener('input', function() {
var activeObject = canvas.getActiveObject();
if (activeObject && activeObject.type === 'text') {
    activeObject.set('lineHeight', parseFloat(this.value));
    canvas.renderAll();
    saveState();
}
});

document.getElementById('word-spacing').addEventListener('input', function() {
var activeObject = canvas.getActiveObject();
if (activeObject && activeObject.type === 'text') {
    activeObject.set('charSpacing', parseFloat(this.value));
    canvas.renderAll();
    saveState();
}
});

                        </script>
                        <br>

                        <div id="texteditor" class="btn-toolbar" role="toolbar">
                                <div class="dropdown">
                                    <button id="font-family" style="width: 100%;" class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" title="Font Style">
                                        <i class="icon-font" style="width:19px;height:19px;">A</i>
                                        <span class="caret"></span>
                                    </button>
                                    <ul class="dropdown-menu">
                                        {% for i in fonts %}
                                        <li><a tabindex="-1" onclick="setFont('{{i.font_name}}');" style="font-family:{{i.font_name}} !important;cursor: pointer;">{{i.font_name}}</a></li>
                                    {% endfor %}


                                    </ul>
                                    {% for font in fonts %}
                                    <style>
                                        @font-face {
                                            font-family: '{{ font.font_name }}';
                                            src: url('{{ font.font_file.url }}') format('truetype');
                                        }
                                    </style>
                                {% endfor %}
                                </div>
                                <div class="btn-group" role="group" style="width: 100%;">
                                <button id="text-bold" class="btn btn-default" data-original-title="Bold"><img src="{% static 'custom/img/font_bold.png' %}" height="" width=""></button>
                                <button id="text-italic" class="btn btn-default" data-original-title="Italic"><img src="{% static 'custom/img/font_italic.png' %}" height="" width=""></button>
                               </div>

                               <a class="btn btn-default" href="#" rel="tooltip" data-placement="top" data-original-title="Background Color">
                                <label for="">Background: </label>
                                <input type="color" id="text-bgcolor" class="color-picker" size="7" value="#000000">
                            </a>
                            <a class="btn btn-default" href="#" rel="tooltip" data-placement="top" data-original-title="Font Color">
                                    <label for="">Text Color:</label>
                                    <input type="color" id="text-fontcolor" class="color-picker" size="7" value="#000000">
                                </a>
                                <a class="btn btn-default" href="#" rel="tooltip" data-placement="top" data-original-title="Font Border Color">
                                    <label for="">Border Color:</label>
                                    <input type="color" id="text-strokecolor" class="color-picker" size="7" value="#000000">
                                </a>
                        </div>
                    </div>
                </div>

                <style>
 .shape-controls-container {
            display: none;
            margin-top: 10px;
        }
        .shape-option {
            cursor: pointer;
            margin: 10px;
        }
                </style>
                <div id="shapes" class="tab-pane fade">
                    <div class="well">
                        <div class="shape-controls-container" id="shapeControls">



                            <div>
                                <label for="shapeColorPickerCustom">Select Color:</label><br>
                                <input type="color" class="form-control" id="shapeColorPickerCustom" value="#000000">
                                <span>Make Sure <b>Plain</b> Color is selcted from bottom if you want to change its border color. Happy Editing! </span>
                            </div>
                            <div>
                                <label for="borderWidthCustom">Border Width:</label><br>
                                <input type="number" class="form-control" id="borderWidthCustom" value="8" min="1" max="60">
                            </div>



                            <div>
                                <label for="borderStyleCustom">Border Style:</label><br>
                                <select class="form-control" id="borderStyleCustom">
                                    <option value="solid">Solid</option>
                                    <option value="dashed">Dashed</option>
                                    <option value="dotted">Dotted</option>
                                    <option value="double">Double</option>
                                    <option value="longDash">Long Dash</option>
                                    <option value="shortDash">Short Dash</option>
                                    <option value="dashDot">Dash Dot</option>
                                    <option value="dashDotDot">Dash Dot Dot</option>
                                    <option value="wideDots">Wide Dots</option>
                                    <option value="evenDashDot">Even Dash Dot</option>
                                    <option value="tripleDash">Triple Dash</option>
                                    <option value="smallDashed">Small Dashed</option>
                                    <option value="largeDashed">Large Dashed</option>
                                    <option value="sparseDots">Sparse Dots</option>
                                    <option value="dashDotLong">Dash Dot Long</option>
                                    <option value="complexPattern">Complex Pattern</option>
                                    <option value="hidden">Hidden</option>
                                </select>
                            </div>


                            <div>
                                <label>Fill Type:</label><br>
                                <input type="radio" name="fillType" id="plainColorOption" value="plain" checked> Plain Color
                                <input style="visibility: hidden;" type="radio" name="fillType" id="gradientOption" value="gradient">
                                <label for="gradientOption">
                                    Gradient
                                </label>
                            </div>

                            <div id="plainColorControls">
                                <label for="fillColorPickerCustom">Fill Color:</label><br>
                                <input type="color" class="form-control" id="fillColorPickerCustom" value="#ffffff">
                                <input type="checkbox" id="fillTransparentCustom"> Transparent
                            </div>

                            <div id="gradientControls" style="display: none;">
                                <label for="gradientColorPicker1">Gradient Color 1:</label><br>
                                <input type="color" class="form-control" id="gradientColorPicker1" value="#ff0000">
                                <label for="gradientColorPicker2">Gradient Color 2:</label><br>
                                <input type="color" class="form-control" id="gradientColorPicker2" value="#0000ff">
                                <label for="gradientTypeCustom">Gradient Type:</label><br>
                                <select class="form-control" id="gradientTypeCustom">
                                    <option value="linear">Linear</option>
                                    <option value="radial">Radial</option>
                                </select>
                            </div>





                        </div>
                        <span>If you want to add color shapes please first <b>select Color from color box!</b></span>
                        <hr>
                        <style>
                            .shape-container{
                                display: inline !important;
                            }
                        </style>
                            <div class="row" id="shapeOptionsContainer">
                                <!-- Shapes will be dynamically inserted here -->
                            </div>
                    </div>

                </div>

                <div id="mockups" class="tab-pane fade">
                    <div class="well">
                        <div id="imageOptions">
            			 {% for gallery_image in product_gallery %}
                            	<img class="optionImage" style="margin-top: 5px;" src="{{gallery_image.image.url}}" width="100" height="100">
                            {% endfor %}
                        </div>
                    </div>
                </div>


                <div id="designs" class="tab-pane fade">
                    <div class="well">



                       <!-- Add a new input field for uploading a background image -->
                       <div id="bgImageOptions">
                        <span>Step 1: Choose File</span>
                        <br>
                        <span>Step 2: Click Add Image Button</span>
                        <br>
                        <span>Step 3: Choose Your Image</span>
                        <br>
                        <b>Note! You can add multiple Images Here</b>
                        <label for="bgImage">Background Image:</label>
                        <input type="file" id="bgImage" class="form-control" name="bgImage" accept="image/*">
                        <br>
                        <button id="uploadBgImage" style="background: black;color: white;padding: 5px;border: none;display: block;width: 100%;"><i class="fa fa-cloud-upload" aria-hidden="true"></i>&nbsp;Add Image</button>

                        <!-- Add controls for image position adjustment -->
                        <div id="bgImagePositionControls" style="display:none;">
                            <label for="bgImagePositionX">Position X:</label>
                            <input type="range" id="bgImagePositionX" min="0" max="100" value="50">

                            <label for="bgImagePositionY">Position Y:</label>
                            <input type="range" id="bgImagePositionY" min="0" max="100" value="50">
                        </div>


                        <!-- Display previews of uploaded images -->
                        <div id="bgImagePreviewContainer"></div>
                    </div>
                    <hr>
                    <style>
                        #bgImageControls {
    margin-top: 20px;
}

#imagePositionControls button {

    background: transparent;
    border: 1px solid black;
    color: rgb(0, 0, 0);
}

#imagePositionControls button i{

font-size: 25px;
padding: 5px;
}
#imagePositionControls button:hover{

color: rgb(255, 255, 255);
background: black;
}
#imageScaleControl,
#imageRotateControl {
    margin-top: 20px;
}

                    </style>
                    <div id="bgImageControls">






                        <!-- Position Controls -->
                        <div id="imagePositionControls">
                            <label>Move Image:</label><br>
                            <button id="moveUp"><i class="fa fa-arrow-up"></i></button>
                            <button id="moveLeft"><i class="fa fa-arrow-left" aria-hidden="true"></i></button>
                            <button id="moveDown"><i class="fa fa-arrow-down" aria-hidden="true"></i></button>
                            <button id="moveRight"><i class="fa fa-arrow-right" aria-hidden="true"></i></button>
                        </div>

                        <!-- Scale Control -->
                        <div id="imageScaleControl">
                            <label for="scaleRange">Scale Image:</label>
                            <input type="range" id="scaleRange" min="0.5" max="2" step="0.1" value="1">
                        </div>

                        <div id="imageRotateControl" style="visibility: hidden;">
                            <label for="rotateRange">Rotate Image:</label>
                            <input type="range" id="rotateRange" min="0" max="360" step="1" value="0">
                        </div>

<hr>
                        <!-- Background Repeat Control -->
    <div id="bgImageRepeatControl">
        <label for="bgRepeatToggle">Repeat Background:</label>
        <input type="checkbox" id="bgRepeatToggle">
    </div>
                    </div>
<hr>
                    <div id="builtinBackgrounds">
                        <h5>Select a Built-in Background</h5>
                        {% for i in designs %}
                            <img src="{{i.image.url}}" height="50" width="50" class="builtin-bg" alt="{{i.design_uid}}">
                        {% endfor %}

                    </div>

                    </div>
                </div>



                <div id="pattern" class="tab-pane fade">
                    <div class="well">
                        <div id="imageOptions">
            			    {% for i in patteren %}
                            	<img class="optionImage" style="margin-top: 5px;" src="{{i.image.url}}" width="100" height="100">
                            {% endfor %}
                        </div>

                    </div>
                </div>




              </div>


            </div>
        </div>
        <div class="col-md-6 col-12">
            <div align="center" style="min-height: 32px;">
                <div class="clearfix">



                    <div class="btn-group inline pull-left" id="texteditor" style="display:block !important">

                        <button id="drawing-mode" class="btn btn-default">
                            <i class="fa fa-pencil"></i>
                        </button>

                        <button title="Zoom In"  onclick="resizePlus()" class="btn btn-default">
                            <i class="fa fa-search-plus"></i>
                        </button>
                        <button title="Zoom Out"  onclick="resizeMinus()" class="btn btn-default">
                            <i class="fa fa-search-minus"></i>
                        </button>
                        <button title="Rotate"  onclick="rotate()" class="btn btn-default">
                            <i class="fa fa-refresh"></i>
                        </button>
                        <button title="Line"  id="draw" class="btn btn-default">
                            <i class="fa fa-minus" style="transform: rotate(120deg);"></i>
                        </button>



                    </div>

                    <div class="pull-right" align="" id="imageeditor" style="display:block !important">
                      <div class="btn-group">
                        <style>

.undobtn {
    background: transparent !important;
    border: 1px solid black;

}
.undobtn i {
  transition: transform 1s linear;

}

.undobtn:active i {
  transform: rotate(-270deg);
}
.redobtn {
    background: transparent !important;
    border: 1px solid black;

}
.redobtn i {
  transition: transform 1s linear;
}
.redobtn:active i{
    transform: rotate(270deg);

}
.deletetrash{
    background: transparent !important;
    border: 1px solid black;
}

                        </style>



                           <button style="display: none;" class="btn" id="bring-to-front" title="Bring to Front"><i class="fa fa-fast-backward rotate" style="display: none; height:19px;transform: rotate(90deg);"></i></button>
                          <button style="display: none;" class="btn" id="send-to-back" title="Send to Back"><i class="fa fa-fast-backward rotate" style="display: none; height:19px;transform: rotate(270deg)"></i></button>
                          <button style="display: none;" id="flip" type="button" class="btn" title="Show Back View" ><i class="fa fa-retweet" style="display: none; height:19px;"></i></button>
                          <button style="margin: 5px;transform: scale(1.1);" id="undoButton" class="btn undobtn" title="Undo selected item"><i class="fa fa-undo"></i></button>
                          <button style="margin: 5px;transform: scale(1.1);" id="redoButton" class="btn redobtn" title="Redo selected item"><i class="fa fa-repeat"></i></button>
                          <button style="margin: 5px;transform: scale(1.1);" id="remove-selected" class="btn deletetrash" title="Delete selected item"><i class="fa fa-trash"></i></button>
                          <button style="margin: 5px;transform: scale(1.1);" id="clearCanvasButton" class="btn btn-danger">Clear Canvas</button>
<!-- JavaScript -->
<script>
    let historyStack = [];
    let redoStack = [];


    function saveState() {
        redoStack = []; // Clear redoStack
        historyStack.push(canvas.toJSON());
    }

    function undo() {
        if (historyStack.length > 1) {
            redoStack.push(historyStack.pop());
            canvas.loadFromJSON(historyStack[historyStack.length - 1], function() {
                canvas.renderAll();
            });
        }
    }

    function redo() {
        if (redoStack.length > 0) {
            historyStack.push(redoStack.pop());
            canvas.loadFromJSON(historyStack[historyStack.length - 1], function() {
                canvas.renderAll();
            });
        }
    }

    // Button event listeners
    document.getElementById('undoButton').addEventListener('click', undo);
    document.getElementById('redoButton').addEventListener('click', redo);

    // Initial save state to history stack
    historyStack.push(canvas.toJSON());
</script>






                        </div>
                    </div>
                </div>
            </div>

<style>

/* Default styles (for desktop screens) */
#shirtDiv {
    width: 600px;
    height: 530px;
    position: relative;
    overflow: hidden; /* Prevents overflow */
    background-color: #fff; /* Optional: ensures the background is white */
}

#tshirtFacing {
    width: 100%; /* Ensures the image spans the full width of the container */
    height: 100%; /* Ensures the image spans the full height of the container */
    object-fit: contain; /* Ensures the image maintains its aspect ratio */
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%); /* Centers the image */
}

#drawingArea, #tcanvas {
    width: 100%;
    height: 100%;
    position: absolute; /* Ensures they are stacked on top of each other */
}

#drawingArea {
    top: 10px; /* Adjust top margin as needed */
    left: 10px; /* Adjust left margin as needed */
    z-index: 10;
    box-sizing: border-box; /* Include padding and border in the element's total width and height */
}

#tcanvas {
    width: 100%;
    height: 100%;
    -webkit-user-select: none;
}

/* Responsive styles (for mobile screens) */
@media (max-width: 767px) {
    #shirtDiv {
        width: 100%;
        height: 550px; /* Allows height to adjust based on width */
    }

    #tshirtFacing {
        width: 100%; /* Adjust width for mobile */
        height: auto; /* Maintain aspect ratio */
    }

    #drawingArea {
        top: 5px;
        left: 5%;
        width: 90%; /* Adjust width */
        height: auto;
    }

    #tcanvas {
        width: 100%;
        height: 100%;
    }
}


</style>




            <br>
            <button style="background: transparent;border: none;color: rgb(17,0,255);" onclick="loadPage(5)"><ins> Page 1</ins></button>
            <button style="background: transparent;border: none;color: rgb(17,0,255);" onclick="loadPage(1)"><ins> Page 2</ins></button>
            <button style="background: transparent;border: none;color: rgb(17,0,255);" onclick="loadPage(2)"><ins> Page 3</ins></button>
            <button style="background: transparent;border: none;color: rgb(17,0,255);" onclick="loadPage(3)"><ins> Page 4</ins></button>
            <button style="background: transparent;border: none;color: rgb(17,0,255);" onclick="loadPage(4)"><ins> Page 5</ins></button>
            <button style="background: transparent;border: none;color: rgb(17,0,255);visibility: hidden;" onclick="loadPage(0)"><ins> Page 1</ins></button>
            <button id="saveButton" onclick="saveDesign()">Save Design</button>

            <button id="clearStorageButton">Clear Local Storage</button>



            <div id="shirtDiv" class="page">
                <img id="tshirtFacing" src="{{single_product.images.url}}" crossorigin='anonymous' alt="T-shirt Image" />
                <div id="drawingArea">
                    <canvas id="tcanvas"></canvas>
                </div>
            </div>

    <script>
        function resizeCanvas() {
    const shirtDiv = document.getElementById('shirtDiv');
    const drawingArea = document.getElementById('drawingArea');
    const canvas = document.getElementById('tcanvas');

    // Set the size of drawingArea to match shirtDiv
    drawingArea.style.width = `${shirtDiv.clientWidth}px`;
    drawingArea.style.height = `${shirtDiv.clientHeight}px`;

    // Set the canvas size to match drawingArea
    canvas.width = drawingArea.clientWidth;
    canvas.height = drawingArea.clientHeight;

    // Optionally, adjust canvas scale
    const ctx = canvas.getContext('2d');
    ctx.scale(canvas.width / 600, canvas.height / 530); // Adjust if needed
}

window.addEventListener('resize', resizeCanvas);
resizeCanvas(); // Initial call to set size

    </script>


<script>
    document.getElementById('clearStorageButton').addEventListener('click', function() {
        if (confirm('Are you sure you want to clear the local storage? This action cannot be undone.')) {
            localStorage.removeItem('shirtDivPages'); // Use removeItem to ensure the specific key is cleared
            alert('Local storage has been cleared.');
            location.reload(); // Reload the page to ensure all data is cleared
        } else {
            alert('Local storage clearing canceled.');
        }
    });

    var canvas;
    var pages = [null, null, null, null, null];
    var currentPage = 0;

    function initializeCanvas() {
        canvas = new fabric.Canvas('tcanvas', {
            hoverCursor: 'pointer',
            selection: true,
            selectionBorderColor: 'blue'
        });

        canvas.on({
            'object:moving': function (e) {
                e.target.opacity = 0.5;
            },
            'object:modified': function (e) {
                e.target.opacity = 1;
            },
            'object:selected': function(e) {
                onObjectSelected(e.target);
            },
            'selection:updated': function(e) {
                onObjectSelected(e.target);
            },
            'selection:cleared': onSelectedCleared
        });

        const originalFindTarget = canvas.findTarget.bind(canvas);
        canvas.findTarget = function (e) {
            const target = originalFindTarget(e);
            if (target) {
                if (this._hoveredTarget !== target) {
                    canvas.fire('object:over', { target });
                    if (this._hoveredTarget) {
                        canvas.fire('object:out', { target: this._hoveredTarget });
                    }
                    this._hoveredTarget = target;
                }
            } else if (this._hoveredTarget) {
                canvas.fire('object:out', { target: this._hoveredTarget });
                this._hoveredTarget = null;
            }
            return target;
        };
    }

    function saveCurrentPage() {
        var shirtDiv = document.getElementById('shirtDiv');
        var shirtDivState = {
            imgSrc: document.getElementById('tshirtFacing').src,
            bgType: shirtDiv.style.backgroundImage ? 'gradient' : 'color',
            bgColor: shirtDiv.style.backgroundColor,
            bgGradient: shirtDiv.style.backgroundImage,
            canvasState: canvas.toJSON()
        };
        pages[currentPage] = shirtDivState;
        localStorage.setItem('shirtDivPages', JSON.stringify(pages));
    }

    function loadPage(pageIndex) {
        saveCurrentPage();
        currentPage = pageIndex;
        var savedPages = localStorage.getItem('shirtDivPages');
        if (savedPages) {
            pages = JSON.parse(savedPages);
            if (pages[pageIndex]) {
                document.getElementById('tshirtFacing').src = pages[pageIndex].imgSrc;

                var shirtDiv = document.getElementById('shirtDiv');
                if (pages[pageIndex].bgType === 'gradient') {
                    shirtDiv.style.backgroundImage = pages[pageIndex].bgGradient;
                    shirtDiv.style.backgroundColor = '';
                } else {
                    shirtDiv.style.backgroundColor = pages[pageIndex].bgColor;
                    shirtDiv.style.backgroundImage = '';
                }

                canvas.clear();
                canvas.loadFromJSON(pages[pageIndex].canvasState, function() {
                    canvas.renderAll();
                    canvas.forEachObject(function(obj) {
                        obj.set('selectable', true);
                    });
                    canvas.renderAll();
                });
            } else {
                resetPageToDefault();
            }
        } else {
            resetPageToDefault();
        }
    }

    function resetPageToDefault() {
        document.getElementById('tshirtFacing').src = "{{single_product.images.url}}";
        var defaultBackground = '';
        document.getElementById('shirtDiv').style.backgroundImage = defaultBackground;
        document.getElementById('shirtDiv').style.backgroundColor = '';
        canvas.clear();
    }

    function setupDefaultPages() {
        var defaultSettings = [
            { imgSrc: "{{single_product.images.url}}", bgType: "gradient", bgColor: "", bgGradient: "" },
            { imgSrc: "{{single_product.images_hover.url}}", bgType: "color", bgColor: "", bgGradient: "" },
            { imgSrc: "{{single_product.images_three.url}}", bgType: "color", bgColor: "", bgGradient: "" },
            { imgSrc: "{{single_product.images_four.url}}", bgType: "color", bgColor: "", bgGradient: "" },
            { imgSrc: "{{single_product.images_five.url}}", bgType: "color", bgColor: "", bgGradient: "" },
            { imgSrc: "{{single_product.images.url}}", bgType: "gradient", bgColor: "", bgGradient: "" },
        ];

        for (var i = 0; i < 6; i++) {
            pages[i] = {
                imgSrc: defaultSettings[i].imgSrc,
                bgType: defaultSettings[i].bgType,
                bgColor: defaultSettings[i].bgColor,
                bgGradient: defaultSettings[i].bgGradient,
                canvasState: null
            };
        }

        loadPage(0);
    }

    function saveDesign() {
        saveCurrentPage();
        alert("Design has been saved!");
    }

    document.addEventListener('DOMContentLoaded', function () {
        initializeCanvas();

        var savedPages = localStorage.getItem('shirtDivPages');
        if (savedPages) {
            pages = JSON.parse(savedPages);
            loadPage(5);
        } else {
            setupDefaultPages();
        }
    });
</script>


        </div>
        <div class="col-md-3 col-12">
            <div class="well">
                <h3>Configuration Tools</h3>
                <hr>
                <span>Remove Image Background:</span>
                <br>
                <a style="border-bottom: 1px solid black;" href="https://www.remove.bg/" target="_blank" >https://tinyurl.com/y8d7g8pk <i class="fa fa-external-link" aria-hidden="true"></i>
                </a>
                <hr>
                <p>
                    <table class="table">
                        <tr>
                            <div class="object-options">
                                <h4>Object Options:</h4>
                                <button style="background:transparent !important;margin:2px;border:1px solid black;" id="flip-v"><svg width="25" height="25" enable-background="new 0 0 16 16" viewBox="0 0 16 20" xml:space="preserve"><g transform="matrix(1.5365 0 0 1.5385 -.45052 -3.0769)"><rect x="5" y="8" width="1" height="1"></rect><rect x="7" y="8" width="1" height="1"></rect><rect x="9" y="8" width="1" height="1"></rect><rect x="1" y="8" width="1" height="1"></rect><rect x="3" y="8" width="1" height="1"></rect><path d="M 1,2 5.5,6 10,2 Z M 7.37,3 5.5,4.662 3.63,3 Z"></path><polygon points="5.5 11 1 15 10 15"></polygon></g></svg></button>
                                <button style="background:transparent !important;margin:2px;border:1px solid black;" id="flip-h"><svg width="25" height="25" enable-background="new 0 0 16 16" viewBox="0 0 16 20" xml:space="preserve"><g transform="matrix(0 1.5365 1.5385 0 -5.0769 1.5495)"><rect x="5" y="8" width="1" height="1"></rect><rect x="7" y="8" width="1" height="1"></rect><rect x="9" y="8" width="1" height="1"></rect><rect x="1" y="8" width="1" height="1"></rect><rect x="3" y="8" width="1" height="1"></rect><path d="M 1,2 5.5,6 10,2 Z M 7.37,3 5.5,4.662 3.63,3 Z"></path><polygon points="10 15 5.5 11 1 15"></polygon></g></svg></button>
                                <button style="background:transparent !important;margin:2px;border:1px solid black;" id="bring-fwd"><svg width="25" height="25" x="0px" y="0px" viewBox="0 0 1000 1000" enable-background="new 0 0 1000 1000" xml:space="preserve"><g><path d="M10,10h686v686H10V10 M990,304v686H304V794h98v98h490V402h-98v-98H990z"></path></g></svg></button>
                                <button style="background:transparent !important;margin:2px;border:1px solid black;" id="bring-back"><svg width="25" height="25" enable-background="new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xml:space="preserve"><path d="m990 990h-686v-686h686v686m-980-294v-686h686v680h-98v-582h-490v490h200v98z"></path><rect x="108.44" y="108" width="490" height="490" fill="#fff"></rect></svg></button>
                                <button style="background:transparent !important;margin:2px;border:1px solid black;" id="duplicate"><svg width="25" height="25" id="Capa_1" x="0px" y="0px" viewBox="0 0 512 512" xml:space="preserve"><g><g><g><path d="M42.667,256c0-59.52,35.093-110.827,85.547-134.827V75.2C53.653,101.44,0,172.48,0,256s53.653,154.56,128.213,180.8 v-45.973C77.76,366.827,42.667,315.52,42.667,256z"></path><path d="M320,64c-105.92,0-192,86.08-192,192s86.08,192,192,192s192-86.08,192-192S425.92,64,320,64z M320,405.333 c-82.347,0-149.333-66.987-149.333-149.333S237.653,106.667,320,106.667S469.333,173.653,469.333,256 S402.347,405.333,320,405.333z"></path><polygon points="341.333,170.667 298.667,170.667 298.667,234.667 234.667,234.667 234.667,277.333 298.667,277.333 298.667,341.333 341.333,341.333 341.333,277.333 405.333,277.333 405.333,234.667 341.333,234.667  "></polygon></g></g></g></svg></button>
                                <button style="background:transparent !important;margin:2px;border:1px solid black;" id="delete"><svg width="25" height="25" id="Layer_1" x="0px" y="0px" viewBox="0 0 512 512" xml:space="preserve"><g><g><path d="M425.298,51.358h-91.455V16.696c0-9.22-7.475-16.696-16.696-16.696H194.855c-9.22,0-16.696,7.475-16.696,16.696v34.662 H86.704c-9.22,0-16.696,7.475-16.696,16.696v51.357c0,9.22,7.475,16.696,16.696,16.696h5.072l15.26,359.906 c0.378,8.937,7.735,15.988,16.68,15.988h264.568c8.946,0,16.302-7.051,16.68-15.989l15.259-359.906h5.073 c9.22,0,16.696-7.475,16.696-16.696V68.054C441.994,58.832,434.519,51.358,425.298,51.358z M211.551,33.391h88.9v17.967h-88.9 V33.391z M372.283,478.609H139.719l-14.522-342.502h261.606L372.283,478.609z M408.602,102.715c-15.17,0-296.114,0-305.202,0 V84.749h305.202V102.715z"></path></g></g><g><g><path d="M188.835,187.304c-9.22,0-16.696,7.475-16.696,16.696v206.714c0,9.22,7.475,16.696,16.696,16.696 c9.22,0,16.696-7.475,16.696-16.696V204C205.53,194.779,198.055,187.304,188.835,187.304z"></path></g></g><g><g><path d="M255.998,187.304c-9.22,0-16.696,7.475-16.696,16.696v206.714c0,9.22,7.474,16.696,16.696,16.696 c9.22,0,16.696-7.475,16.696-16.696V204C272.693,194.779,265.218,187.304,255.998,187.304z"></path></g></g><g><g><path d="M323.161,187.304c-9.22,0-16.696,7.475-16.696,16.696v206.714c0,9.22,7.475,16.696,16.696,16.696 s16.696-7.475,16.696-16.696V204C339.857,194.779,332.382,187.304,323.161,187.304z"></path></g></g></svg></button>
                               <hr>
                              </div>
                        </tr>
                        <script>
                            document.addEventListener('DOMContentLoaded', function () {
                                // Function to apply changes to selected objects
                                function applyToSelectedObjects(callback) {
                                    var activeObjects = canvas.getActiveObjects();
                                    if (activeObjects.length > 0) {
                                        activeObjects.forEach(callback);
                                        canvas.renderAll();
                                        saveState();
                                    }
                                }

                                // Flip Horizontal
                                document.getElementById('flip-h').onclick = function () {
                                    applyToSelectedObjects(function (object) {
                                        object.set('flipX', !object.flipX);
                                    });
                                };

                                // Flip Vertical
                                document.getElementById('flip-v').onclick = function () {
                                    applyToSelectedObjects(function (object) {
                                        object.set('flipY', !object.flipY);
                                    });
                                };

                                // Bring Forward
                                document.getElementById('bring-fwd').onclick = function () {
                                    applyToSelectedObjects(function (object) {
                                        canvas.bringForward(object);
                                    });
                                };

                                // Bring Backward
                                document.getElementById('bring-back').onclick = function () {
                                    applyToSelectedObjects(function (object) {
                                        canvas.sendBackwards(object);
                                    });
                                };

                                // Duplicate
                                document.getElementById('duplicate').onclick = function () {
                                    var activeObjects = canvas.getActiveObjects();
                                    if (activeObjects.length > 0) {
                                        activeObjects.forEach(function (object) {
                                            var clone = fabric.util.object.clone(object);
                                            clone.set({
                                                left: object.left + 10,
                                                top: object.top + 10
                                            });
                                            canvas.add(clone);
                                            clone.setCoords();
                                        });
                                        canvas.renderAll();
                                        saveState();
                                    }
                                };

                                // Delete
                                document.getElementById('delete').onclick = function () {
                                    var activeObjects = canvas.getActiveObjects();
                                    if (activeObjects.length > 0) {
                                        activeObjects.forEach(function (object) {
                                            canvas.remove(object);
                                        });
                                        canvas.discardActiveObject(); // Clear selection
                                        canvas.renderAll();
                                        saveState();
                                    }
                                };
                            });

                        </script>

<tr>
    <h4>ALignments:</h4>
    <button style="background:transparent;border:1px solid black;color:black;margin:2px" id="align-to-left"><svg width="25px" height="25px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path fill-rule="evenodd" clip-rule="evenodd" d="M3.375 1.625C3.78921 1.625 4.125 1.96079 4.125 2.375L4.125 22.375C4.125 22.7892 3.78921 23.125 3.375 23.125C2.96079 23.125 2.625 22.7892 2.625 22.375L2.625 2.375C2.625 1.96079 2.96079 1.625 3.375 1.625Z" fill="#1C274C"/>
        <path d="M7.375 7.875C7.375 6.94038 7.375 6.47308 7.57596 6.125C7.70761 5.89697 7.89697 5.70761 8.125 5.57596C8.47308 5.375 8.94038 5.375 9.875 5.375H18.875C19.8096 5.375 20.2769 5.375 20.625 5.57596C20.853 5.70761 21.0424 5.89697 21.174 6.125C21.375 6.47308 21.375 6.94038 21.375 7.875C21.375 8.80962 21.375 9.27692 21.174 9.625C21.0424 9.85303 20.853 10.0424 20.625 10.174C20.2769 10.375 19.8096 10.375 18.875 10.375L9.875 10.375C8.94038 10.375 8.47308 10.375 8.125 10.174C7.89697 10.0424 7.70761 9.85303 7.57596 9.625C7.375 9.27692 7.375 8.80962 7.375 7.875Z" fill="#1C274C"/>
        <path d="M7.375 16.875C7.375 15.9404 7.375 15.4731 7.57596 15.125C7.70761 14.897 7.89697 14.7076 8.125 14.576C8.47308 14.375 8.94038 14.375 9.875 14.375L15.875 14.375C16.8096 14.375 17.2769 14.375 17.625 14.576C17.853 14.7076 18.0424 14.897 18.174 15.125C18.375 15.4731 18.375 15.9404 18.375 16.875C18.375 17.8096 18.375 18.2769 18.174 18.625C18.0424 18.853 17.853 19.0424 17.625 19.174C17.2769 19.375 16.8096 19.375 15.875 19.375H9.875C8.94038 19.375 8.47308 19.375 8.125 19.174C7.89697 19.0424 7.70761 18.853 7.57596 18.625C7.375 18.2769 7.375 17.8096 7.375 16.875Z" fill="#1C274C"/>
        </svg></button>
<button style="background:transparent;border:1px solid black;color:black;margin:2px" id="align-to-right"><svg width="25px" height="25px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M20.625 1.625C20.2108 1.625 19.875 1.96079 19.875 2.375V22.375C19.875 22.7892 20.2108 23.125 20.625 23.125C21.0392 23.125 21.375 22.7892 21.375 22.375V2.375C21.375 1.96079 21.0392 1.625 20.625 1.625Z" fill="#1C274C"/>
<path d="M16.625 7.875C16.625 6.94038 16.625 6.47308 16.424 6.125C16.2924 5.89697 16.103 5.70761 15.875 5.57596C15.5269 5.375 15.0596 5.375 14.125 5.375L5.125 5.375C4.19038 5.375 3.72308 5.375 3.375 5.57596C3.14697 5.70761 2.95761 5.89697 2.82596 6.125C2.625 6.47307 2.625 6.94038 2.625 7.875C2.625 8.80961 2.625 9.27692 2.82596 9.625C2.95761 9.85303 3.14697 10.0424 3.375 10.174C3.72308 10.375 4.19038 10.375 5.125 10.375L14.125 10.375C15.0596 10.375 15.5269 10.375 15.875 10.174C16.103 10.0424 16.2924 9.85303 16.424 9.625C16.625 9.27692 16.625 8.80962 16.625 7.875Z" fill="#1C274C"/>
<path d="M16.625 16.875C16.625 15.9404 16.625 15.4731 16.424 15.125C16.2924 14.897 16.103 14.7076 15.875 14.576C15.5269 14.375 15.0596 14.375 14.125 14.375L8.125 14.375C7.19038 14.375 6.72308 14.375 6.375 14.576C6.14697 14.7076 5.95761 14.897 5.82596 15.125C5.625 15.4731 5.625 15.9404 5.625 16.875C5.625 17.8096 5.625 18.2769 5.82596 18.625C5.95761 18.853 6.14697 19.0424 6.375 19.174C6.72308 19.375 7.19038 19.375 8.125 19.375H14.125C15.0596 19.375 15.5269 19.375 15.875 19.174C16.103 19.0424 16.2924 18.853 16.424 18.625C16.625 18.2769 16.625 17.8096 16.625 16.875Z" fill="#1C274C"/>
</svg></button>
<button style="background:transparent;border:1px solid black;color:black;margin:2px" id="align-to-top">
<svg width="25px" height="25px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M1.25 3.75C1.25 4.16421 1.58579 4.5 2 4.5H22C22.4142 4.5 22.75 4.16421 22.75 3.75C22.75 3.33579 22.4142 3 22 3H2C1.58579 3 1.25 3.33579 1.25 3.75Z" fill="#1C274C"/>
<path d="M7.5 7.75C6.56538 7.75 6.09808 7.75 5.75 7.95096C5.52197 8.08261 5.33261 8.27197 5.20096 8.5C5 8.84808 5 9.31538 5 10.25L5 19.25C5 20.1846 5 20.6519 5.20096 21C5.33261 21.228 5.52197 21.4174 5.75 21.549C6.09808 21.75 6.56538 21.75 7.5 21.75C8.43462 21.75 8.90192 21.75 9.25 21.549C9.47803 21.4174 9.66739 21.228 9.79904 21C10 20.6519 10 20.1846 10 19.25V10.25C10 9.31538 10 8.84808 9.79904 8.5C9.66739 8.27197 9.47803 8.08261 9.25 7.95096C8.90192 7.75 8.43462 7.75 7.5 7.75Z" fill="#1C274C"/>
<path d="M16.5 7.75C15.5654 7.75 15.0981 7.75 14.75 7.95096C14.522 8.08261 14.3326 8.27197 14.201 8.5C14 8.84808 14 9.31538 14 10.25V16.25C14 17.1846 14 17.6519 14.201 18C14.3326 18.228 14.522 18.4174 14.75 18.549C15.0981 18.75 15.5654 18.75 16.5 18.75C17.4346 18.75 17.9019 18.75 18.25 18.549C18.478 18.4174 18.6674 18.228 18.799 18C19 17.6519 19 17.1846 19 16.25V10.25C19 9.31538 19 8.84808 18.799 8.5C18.6674 8.27197 18.478 8.08261 18.25 7.95096C17.9019 7.75 17.4346 7.75 16.5 7.75Z" fill="#1C274C"/>
</svg>
</button>
<button style="background:transparent;border:1px solid black;color:black;margin:2px" id="align-to-bottom"><svg width="25px" height="25px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M7.5 17C6.56538 17 6.09808 17 5.75 16.799C5.52197 16.6674 5.33261 16.478 5.20096 16.25C5 15.9019 5 15.4346 5 14.5L5 5.5C5 4.56538 5 4.09808 5.20096 3.75C5.33261 3.52197 5.52197 3.33261 5.75 3.20096C6.09808 3 6.56538 3 7.5 3C8.43462 3 8.90192 3 9.25 3.20096C9.47803 3.33261 9.66739 3.52197 9.79904 3.75C10 4.09808 10 4.56538 10 5.5V14.5C10 15.4346 10 15.9019 9.79904 16.25C9.66739 16.478 9.47803 16.6674 9.25 16.799C8.90192 17 8.43462 17 7.5 17Z" fill="#1C274C"/>
<path d="M16.5 17C15.5654 17 15.0981 17 14.75 16.799C14.522 16.6674 14.3326 16.478 14.201 16.25C14 15.9019 14 15.4346 14 14.5V8.5C14 7.56538 14 7.09808 14.201 6.75C14.3326 6.52197 14.522 6.33261 14.75 6.20096C15.0981 6 15.5654 6 16.5 6C17.4346 6 17.9019 6 18.25 6.20096C18.478 6.33261 18.6674 6.52197 18.799 6.75C19 7.09808 19 7.56538 19 8.5V14.5C19 15.4346 19 15.9019 18.799 16.25C18.6674 16.478 18.478 16.6674 18.25 16.799C17.9019 17 17.4346 17 16.5 17Z" fill="#1C274C"/>
<g opacity="0.5">
<path fill-rule="evenodd" clip-rule="evenodd" d="M1.25 21C1.25 20.5858 1.58579 20.25 2 20.25H22C22.4142 20.25 22.75 20.5858 22.75 21C22.75 21.4142 22.4142 21.75 22 21.75H2C1.58579 21.75 1.25 21.4142 1.25 21Z" fill="#1C274C"/>
</g>
</svg></button>
<button style="background:transparent;border:1px solid black;color:black;margin:2px"  id="center-horizontal"><svg width="25px" height="25px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path fill-rule="evenodd" clip-rule="evenodd" d="M14.5 14H9.5C8.56538 14 8.09808 14 7.75 14.201C7.52197 14.3326 7.33261 14.522 7.20096 14.75C7 15.0981 7 15.5654 7 16.5C7 17.4346 7 17.9019 7.20096 18.25C7.33261 18.478 7.52197 18.6674 7.75 18.799C8.09808 19 8.56538 19 9.5 19H14.5C15.4346 19 15.9019 19 16.25 18.799C16.478 18.6674 16.6674 18.478 16.799 18.25C17 17.9019 17 17.4346 17 16.5C17 15.5654 17 15.0981 16.799 14.75C16.6674 14.522 16.478 14.3326 16.25 14.201C15.9019 14 15.4346 14 14.5 14Z" fill="#1C274C"/>
    <path d="M19 7.5C19 6.56539 19 6.09808 18.799 5.75C18.6674 5.52197 18.478 5.33262 18.25 5.20096C17.9019 5 17.4346 5 16.5 5L7.5 5C6.56538 5 6.09808 5 5.75 5.20096C5.52197 5.33261 5.33261 5.52197 5.20096 5.75C5 6.09808 5 6.56538 5 7.5C5 8.43462 5 8.90192 5.20096 9.25C5.33261 9.47803 5.52197 9.66739 5.75 9.79904C6.09808 10 6.56538 10 7.5 10L16.5 10C17.4346 10 17.9019 10 18.25 9.79904C18.478 9.66739 18.6674 9.47803 18.799 9.25C19 8.90192 19 8.43462 19 7.5Z" fill="#1C274C"/>
    <g opacity="0.5">
    <path d="M12.75 5L12.75 2C12.75 1.58579 12.4142 1.25 12 1.25C11.5858 1.25 11.25 1.58579 11.25 2L11.25 5H12.75Z" fill="#1C274C"/>
    <path d="M11.25 10L11.25 14H12.75L12.75 10L11.25 10Z" fill="#1C274C"/>
    <path d="M11.25 19L11.25 22C11.25 22.4142 11.5858 22.75 12 22.75C12.4142 22.75 12.75 22.4142 12.75 22L12.75 19H11.25Z" fill="#1C274C"/>
    </g>
    </svg></button>
<button style="background:transparent;border:1px solid black;color:black;margin:2px"  id="center-vertical"><svg width="25px" height="25px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path fill-rule="evenodd" clip-rule="evenodd" d="M14 9.5V11.25V12.75V14.5C14 15.4346 14 15.9019 14.201 16.25C14.3326 16.478 14.522 16.6674 14.75 16.799C15.0981 17 15.5654 17 16.5 17C17.4346 17 17.9019 17 18.25 16.799C18.478 16.6674 18.6674 16.478 18.799 16.25C19 15.9019 19 15.4346 19 14.5V12.75V11.25V9.5C19 8.56538 19 8.09808 18.799 7.75C18.6674 7.52197 18.478 7.33261 18.25 7.20096C17.9019 7 17.4346 7 16.5 7C15.5654 7 15.0981 7 14.75 7.20096C14.522 7.33261 14.3326 7.52197 14.201 7.75C14 8.09808 14 8.56538 14 9.5Z" fill="#1C274C"/>
    <path d="M7.5 5C6.56538 5 6.09808 5 5.75 5.20096C5.52197 5.33261 5.33261 5.52197 5.20096 5.75C5 6.09808 5 6.56538 5 7.5L5 11.25V12.75L5 16.5C5 17.4346 5 17.9019 5.20096 18.25C5.33261 18.478 5.52197 18.6674 5.75 18.799C6.09808 19 6.56538 19 7.5 19C8.43462 19 8.90192 19 9.25 18.799C9.47803 18.6674 9.66739 18.478 9.79904 18.25C10 17.9019 10 17.4346 10 16.5V12.75L10 11.25V7.5C10 6.56538 10 6.09808 9.79904 5.75C9.66739 5.52197 9.47803 5.33261 9.25 5.20096C8.90192 5 8.43462 5 7.5 5Z" fill="#1C274C"/>
    <g opacity="0.5">
    <path d="M5 11.25H2C1.58579 11.25 1.25 11.5858 1.25 12C1.25 12.4142 1.58579 12.75 2 12.75H5V11.25Z" fill="#1C274C"/>
    <path d="M10 12.75L14 12.75V11.25H10L10 12.75Z" fill="#1C274C"/>
    <path d="M19 12.75L22 12.75C22.4142 12.75 22.75 12.4142 22.75 12C22.75 11.5858 22.4142 11.25 22 11.25L19 11.25V12.75Z" fill="#1C274C"/>
    </g>
    </svg></button>
</tr>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Function to apply alignment to selected objects
        function alignObjects(callback) {
            var activeObjects = canvas.getActiveObjects().filter(obj => obj.type !== 'text');
            if (activeObjects.length > 0) {
                canvas.discardActiveObject();  // Avoid group selection issues
                callback(activeObjects);
                activeObjects.forEach(obj => obj.setCoords());  // Update coordinates once after alignment
                canvas.renderAll(); // Re-render canvas only once after all objects have been aligned
                saveState();
            }
        }

        // Align to Left
        document.getElementById('align-to-left').onclick = function () {
            alignObjects(objects => {
                const minLeft = Math.min(...objects.map(obj => obj.aCoords.tl.x));
                objects.forEach(obj => obj.set({ left: minLeft }));
            });
        };

        // Align to Right
        document.getElementById('align-to-right').onclick = function () {
            alignObjects(objects => {
                const maxRight = Math.max(...objects.map(obj => obj.aCoords.tr.x));
                objects.forEach(obj => obj.set({ left: maxRight - obj.getScaledWidth() }));
            });
        };

        // Align to Top
        document.getElementById('align-to-top').onclick = function () {
            alignObjects(objects => {
                const minTop = Math.min(...objects.map(obj => obj.aCoords.tl.y));
                objects.forEach(obj => obj.set({ top: minTop }));
            });
        };

        // Align to Bottom
        document.getElementById('align-to-bottom').onclick = function () {
            alignObjects(objects => {
                const maxBottom = Math.max(...objects.map(obj => obj.aCoords.bl.y));
                objects.forEach(obj => obj.set({ top: maxBottom - obj.getScaledHeight() }));
            });
        };

        // Center Horizontally
        document.getElementById('center-horizontal').onclick = function () {
            alignObjects(objects => {
                const canvasCenter = canvas.getWidth() / 2;
                const groupCenter = (Math.min(...objects.map(obj => obj.aCoords.tl.x)) +
                                    Math.max(...objects.map(obj => obj.aCoords.tr.x))) / 2;
                const offset = canvasCenter - groupCenter;
                objects.forEach(obj => obj.set({ left: obj.left + offset }));
            });
        };

        // Center Vertically
        document.getElementById('center-vertical').onclick = function () {
            alignObjects(objects => {
                const canvasCenter = canvas.getHeight() / 2;
                const groupCenter = (Math.min(...objects.map(obj => obj.aCoords.tl.y)) +
                                    Math.max(...objects.map(obj => obj.aCoords.bl.y))) / 2;
                const offset = canvasCenter - groupCenter;
                objects.forEach(obj => obj.set({ top: obj.top + offset }));
            });
        };
    });
</script>

<hr>
<br>
                        <tr >
                            <span style="font-weight: bold;">Set Position:</span><br>

                            <button style="margin: 2px;background: transparent;border: 1px solid gainsboro;" id="align-center-top" title="Align Center Top"><img height="25" width="25" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAABCElEQVR4nO2ZQWqDUBCGvzPlDC1R0jQ9QDcNhKQHbVal6QmaRQ/RZBENwiwej1GkC5kn/wcDojPP9/GrG0EIIcRMebIqmgq4WHXHRbIE/oDW6gqsKVyiLVGm6pFIZZ4pXKItQaYaKRFaZmVfpnSjN2fz+bmLzYagdpJogIMj8ubIdMlsokq82/VcpGMbTaZ2HqdUok9kSOZlaolHu3Euscv6+kSw3saReZjQgy9HYu/0DYlgM7nMJxNydF5s/iGCzaYyH0zIAvgGzsDrQN8YEWyNbq2TrR2OsSLhaSUSDCUSDSUSDSUSDSUSDSUSDSUSDSUSjdkkck4kfiiYGvi1KvZHjxBCiPlzByBF6fap882hAAAAAElFTkSuQmCC"></button>
                            <button style="margin: 2px;background: transparent;border: 1px solid gainsboro;" id="align-center-bottom" title="Align Center Bottom"><img height="25" width="25" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAABI0lEQVR4nO3YXUsCQRiG4Zv6Xx1IZEFFlHVSIhadRD+7jDqQIizXPiYGRliWGTOR2XfiuWBAxJW5fV1xF0REROw6AcbAE3BIwR4AF9YdBXONVSynEGM0EWs0EWs0EWs0EWs0EWs0EWs0EWvMT6QPPAOPQG8NIb1wWTwC9slkE3ipbe4zhK0a0g/vMX/NPZlshDsj9Q36jQxWCBk0IlzOEO8ssoEvYPiHkGE4pvmBHJPZKfDR2Mg3cLNEyGUi4oKW+JN0tiAmFnKViDinZf5XZhqJuY2EXEciZm18nVKOgCoS4355rgrHmrIHvEc2n1omI+Z2l4ypSrip3QXeFkT48+mAQuwkYqY5/4KsyxbwWouYANsUqhMCJuFx0Tr/IUJERIj5AXrs6zGCTBgSAAAAAElFTkSuQmCC"></button>
                            <button style="margin: 2px;background: transparent;border: 1px solid gainsboro;" id="align-top-left" title="Align Top Left"><img height="25" width="25" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAzElEQVR4nO3YsQrCMBjE8Xs8u9glkMVnt2DBl1A4ETqFVNta6Hfx/pDBzR+3JAWcc38ddzoDgK4FCAGMhuzQXmtcAZwiQp4ALhCKrWBYnEfld4YgJFUwEsuwOFDFsAKRxHAGIofhB4gUhl8gMhgugEhguBASHsMVkNAYroSExXADJCRmKK7iUMV008tu3PieyMoXzdDL/JoxUfMyUfMyUfMyUfMyUfMyUUu+aAYttbRMnnmc9WgEc4NoucDcIVw/fRB5r3E++s8453BcL9KbTZi0iQWWAAAAAElFTkSuQmCC"></button>
                            <button style="margin: 2px;background: transparent;border: 1px solid gainsboro;" id="align-top-right" title="Align Top Right"><img height="25" width="25" style="transform: rotate(90deg);" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAzElEQVR4nO3YsQrCMBjE8Xs8u9glkMVnt2DBl1A4ETqFVNta6Hfx/pDBzR+3JAWcc38ddzoDgK4FCAGMhuzQXmtcAZwiQp4ALhCKrWBYnEfld4YgJFUwEsuwOFDFsAKRxHAGIofhB4gUhl8gMhgugEhguBASHsMVkNAYroSExXADJCRmKK7iUMV008tu3PieyMoXzdDL/JoxUfMyUfMyUfMyUfMyUfMyUUu+aAYttbRMnnmc9WgEc4NoucDcIVw/fRB5r3E++s8453BcL9KbTZi0iQWWAAAAAElFTkSuQmCC"></button>
                            <button style="margin: 2px;background: transparent;border: 1px solid gainsboro;" id="align-bottom-left" title="Align Bottom Left"><img height="25" width="25" style="transform: rotate(270deg);"  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAzElEQVR4nO3YsQrCMBjE8Xs8u9glkMVnt2DBl1A4ETqFVNta6Hfx/pDBzR+3JAWcc38ddzoDgK4FCAGMhuzQXmtcAZwiQp4ALhCKrWBYnEfld4YgJFUwEsuwOFDFsAKRxHAGIofhB4gUhl8gMhgugEhguBASHsMVkNAYroSExXADJCRmKK7iUMV008tu3PieyMoXzdDL/JoxUfMyUfMyUfMyUfMyUfMyUUu+aAYttbRMnnmc9WgEc4NoucDcIVw/fRB5r3E++s8453BcL9KbTZi0iQWWAAAAAElFTkSuQmCC"></button>
                            <button style="margin: 2px;background: transparent;border: 1px solid gainsboro;" id="align-bottom-right" title="Align Bottom Right"><img height="25" width="25" style="transform: rotate(180deg);"  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAzElEQVR4nO3YsQrCMBjE8Xs8u9glkMVnt2DBl1A4ETqFVNta6Hfx/pDBzR+3JAWcc38ddzoDgK4FCAGMhuzQXmtcAZwiQp4ALhCKrWBYnEfld4YgJFUwEsuwOFDFsAKRxHAGIofhB4gUhl8gMhgugEhguBASHsMVkNAYroSExXADJCRmKK7iUMV008tu3PieyMoXzdDL/JoxUfMyUfMyUfMyUfMyUfMyUUu+aAYttbRMnnmc9WgEc4NoucDcIVw/fRB5r3E++s8453BcL9KbTZi0iQWWAAAAAElFTkSuQmCC"></button>
                            <button style="margin: 2px;background: transparent;border: 1px solid gainsboro;" id="align-center-both" title="Align Center"><img height="25" width="25"  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAAxCAYAAABznEEcAAAACXBIWXMAAAsTAAALEwEAmpwYAAABmElEQVR4nO2asUrDUBSGP+kgDoLg5ODk4qCri+IL1MFFoavUlvoCfQUfQAehFFcnX6GTU0ClTsVBxC4OdlIEhZYrZwghLTW5SU/K+eBCe256z/3v3+TmhIB/asAvMIxpLn5KAbiQCbeBq1BrS9z1F0bEciTuvpuIPDEntGBOaMGc0II5oQVzQgvmRFZUgfqMnKhL/tR0JfklUMpJREnyDSV/ap5CldktsJSxiEXgJpTT5U+NG+ReqjM36B2wmpGIFaAjx10Djz5FBPK5GVqddc8i1mSx3DHnwILk9S7CcQL8AH1g25OIDeBZHiScheKZiXAcAl/AB7CXUsQO8A58A8eRvqlFuNU8mtBeY0Q49oEB8AkcJBRRlt8PZLwogeSfNL+/f0N/zDOicIsT4ahIfy+hiJ7EKmPGD6aY25svJ8ozdGILD+fEroZzIunV6QXYLOLVqVnkfeIBaEmCjuysWe/YLcnrTUTh752683AXWwUaM6onGr7qif9i5akWzAktmBNaMCe0YE5owZzQgjmhhbl4y6aW9/tOI6SVPASB+qyRAAAAAElFTkSuQmCC"></button>


                        </tr>
                        <br>
                        <tr>

                            <div class="row">
                                <div class="col-xs-12">
                                    <div class="form-group">
                                        <label for="width-input">Width:</label>
                                        <div class="input-group">
                                            <input type="text" id="width-input" class="form-control" placeholder="Enter width">
                                            <div class="input-group-btn">
                                                <select id="width-unit" class="btn btn-default">
                                                    <option value="px">px</option>
                                                    <option value="cm">cm</option>
                                                    <option value="in">inches</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xs-12">
                                    <div class="form-group">
                                        <label for="height-input">Height:</label>
                                        <div class="input-group">
                                            <input type="text" id="height-input" class="form-control" placeholder="Enter height">
                                            <div class="input-group-btn">
                                                <select id="height-unit" class="btn btn-default">
                                                    <option value="px">px</option>
                                                    <option value="cm">cm</option>
                                                    <option value="in">inches</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button id="apply-dimensions" class="btn btn-primary">Apply</button>


                        </tr>
                        <br>
                        <tr style="border-bottom: 1px solid black;display: none;" id="drawingTable">
                                <label for="color-picke" id="color-picker-label" style="display: none;">Color:</label>
                                <input type="color" id="color-picker" value="#000000" style="display: none;">
                                <label for="width-slider" id="width-slider-label" style="display: none;">Size:</label>
                                <input type="range" id="width-slider" min="1" max="100" value="5" style="display: none;">
                        </tr>
                        <tr>
                            <style>
                                #controls {
                                    display: none;
                                }
                            </style>
                            <div id="controls">
                                <label for="">Color:</label><br>
                                <input type="color" id="lineColor" value="#ff0000">
                                <br>
                                <label for="">Width:</label><br>
                                <input type="range" id="lineWidth" min="1" max="10" value="5">
                            </div>
                            <hr>
                        </tr>
                        <tr>
                            <h2>{{ single_product.product_name }}</h2>

                            {% if single_product.stock <= 0 %}
                            <h3 style="color: #ff7878;font-weight: bold;">Out of Stock</h3>
                            {% else %}
                            <h3 style="color: #ff7878;font-weight: bold;">Price: {{single_product.price}}  <span style="font-size: 17px;color: gray;"><del>{{single_product.discount_price}}</del></span></h3>
                            {% endif %}
                        </tr>

                    </table>
                </p>


                  <a  href="{% url 'order_product' single_product.slug %}" class="btn btn-large btn-block btn-success" name="download-all-pages" id="download-all-pages">Order Now&nbsp; <i class="fa fa-shopping-basket"></i></a>
            </div>
          </div>
        </div>
    </div>
</div>

<script>
    document.getElementById('download-all-pages').addEventListener('click', async function (event) {
        event.preventDefault();
    
        var button = event.target;
        var originalText = button.textContent;
        button.textContent = "Loading...";
    
        var zip = new JSZip();
        var pageCount = pages.length;
    
        function saveCanvasAsPng(pageIndex) {
            return new Promise((resolve, reject) => {
                loadPage(pageIndex); // Load the correct page with its specific image
                setTimeout(function () {
                    html2canvas(document.getElementById('shirtDiv'), {
                        useCORS: true,
                        allowTaint: true,
                        logging: true,
                        timeout: 5000,
                    }).then(function (canvas) {
                        canvas.toBlob(function (blob) {
                            zip.file('page-' + (pageIndex + 1) + '.png', blob);
                            
                            // Add background images if they exist
                            var bgImageInput = document.getElementById('bgImage');
                            if (bgImageInput.files.length > 0) {
                                for (var i = 0; i < bgImageInput.files.length; i++) {
                                    var bgFile = bgImageInput.files[i];
                                    zip.file('background-image-' + (i + 1) + '.png', bgFile);
                                }
                            }
    
                            // Add logo images if they exist
                            var logoInput = document.getElementById('ownlogo');
                            if (logoInput.files.length > 0) {
                                for (var j = 0; j < logoInput.files.length; j++) {
                                    var logoFile = logoInput.files[j];
                                    zip.file('logo-image-' + (j + 1) + '.png', logoFile);
                                }
                            }
    
                            resolve();
                        });
                    }).catch(function (error) {
                        reject(error);
                    });
                }, 500);
            });
        }
    
        async function downloadAllPages() {
            try {
                for (var i = 0; i < pageCount; i++) {
                    await saveCanvasAsPng(i);
                }
                zip.generateAsync({ type: 'blob' }).then(function (content) {
                    saveAs(content, 'shirt-designs.zip');
                    button.textContent = originalText;
                    setTimeout(function () {
                        window.location.href = button.href;
                    }, 2000);
                });
            } catch (error) {
                console.error(error);
                button.textContent = originalText;
            }
        }
    
        downloadAllPages();
    });
    </script>
    
{% comment %} <script>
    document.getElementById('download-all-pages').addEventListener('click', async function (event) {
        event.preventDefault();
    
        var button = event.target;
        var originalText = button.textContent;
        button.textContent = "Loading...";
    
        var zip = new JSZip();
        var pageCount = pages.length;
    
        function saveCanvasAsPng(pageIndex) {
            return new Promise((resolve, reject) => {
                loadPage(pageIndex); // Load the correct page with its specific image
                setTimeout(function () {
                    html2canvas(document.getElementById('shirtDiv'), {
                        useCORS: true,
                        allowTaint: true,
                        logging: true,
                        timeout: 5000,
                    }).then(function (canvas) {
                        canvas.toBlob(function (blob) {
                            zip.file('page-' + (pageIndex + 1) + '.png', blob);
                            
                            // Add background image if exists
                            var bgImageInput = document.getElementById('bgImage');
                            if (bgImageInput.files.length > 0) {
                                var bgFile = bgImageInput.files[0];
                                zip.file('background-image.png', bgFile);
                            }
    
                            // Add logo image if exists
                            var logoInput = document.getElementById('ownlogo');
                            if (logoInput.files.length > 0) {
                                var logoFile = logoInput.files[0];
                                zip.file('logo-image.png', logoFile);
                            }
    
                            resolve();
                        });
                    }).catch(function (error) {
                        reject(error);
                    });
                }, 500);
            });
        }
    
        async function downloadAllPages() {
            try {
                for (var i = 0; i < pageCount; i++) {
                    await saveCanvasAsPng(i);
                }
                zip.generateAsync({ type: 'blob' }).then(function (content) {
                    saveAs(content, 'shirt-designs.zip');
                    button.textContent = originalText;
                    setTimeout(function () {
                        window.location.href = button.href;
                    }, 2000);
                });
            } catch (error) {
                console.error(error);
                button.textContent = originalText;
            }
        }
    
        downloadAllPages();
    });
    </script>
     {% endcomment %}

<br><br><br>
{% include "includes/footer.html" %}




<script src="{% static 'assets/js/bootstrap.min.js' %}"></script>
<script src="{% static 'assets/js/bootstrap-hover-dropdown.min.js' %}"></script>
<script src="{% static 'assets/js/scripts.js' %}"></script>
<script src="{% static 'custom/js/shapes.js' %}"></script>

<script type="text/javascript">


$('#flip').click(
		   function() {
			   	if ($(this).attr("data-original-title") == "Show Back View") {
			   		$(this).attr('data-original-title', 'Show Front View');
			        $("#tshirtFacing").attr("src",`{{single_product.images_hover.url}}`);
			        a = JSON.stringify(canvas);
			        canvas.clear();
			        try
			        {
			           var json = JSON.parse(b);
			           canvas.loadFromJSON(b);
			        }
			        catch(e)
			        {}

			    } else {
			    	$(this).attr('data-original-title', 'Show Back View');
			    	$("#tshirtFacing").attr("src",`{{single_product.images.url}}`);
			    	b = JSON.stringify(canvas);
			    	canvas.clear();
			    	try
			        {
			           var json = JSON.parse(a);
			           canvas.loadFromJSON(a);
			        }
			        catch(e)
			        {}
			    }
			   	canvas.renderAll();
			   	setTimeout(function() {
			   		canvas.calcOffset();
			    },200);
});


var opacitySlider = document.getElementById('opacity-slider');

// Add event listener to the opacity slider
opacitySlider.addEventListener('input', function() {
    var activeObject = canvas.getActiveObject();
    if (activeObject && activeObject.type === 'image') {
        activeObject.set('opacity', parseFloat(this.value));
        canvas.renderAll();
        saveState();
    }
});


// ======================free drawing

// Get the canvas element
// Add a button to toggle the drawing mode
var drawingModeButton = document.getElementById('drawing-mode');
// Add a color picker to change the brush color
var colorPicker = document.getElementById('color-picker');
var colorPickerLabel = document.getElementById('color-picker-label');
// Add a width slider to change the brush width
var widthSlider = document.getElementById('width-slider');
var widthSliderLabel = document.getElementById('width-slider-label');
var drawingTable = document.getElementById('drawingTable');


// Add an event listener to the color picker
colorPicker.addEventListener('change', function() {
  if (canvas.isDrawingMode) {
    // Change the brush color
    canvas.freeDrawingBrush.color = this.value;
    canvas.freeDrawingBrush.dirty = true;
    canvas.renderAll();
    saveState();
  }
});

// Add an event listener to the width slider
widthSlider.addEventListener('change', function() {
  if (canvas.isDrawingMode) {
    // Change the brush width
    canvas.freeDrawingBrush.width = parseInt(this.value);
    canvas.freeDrawingBrush.dirty = true;
    canvas.renderAll();
    saveState();
  }
});

// Add an event listener to the button
drawingModeButton.addEventListener('click', function() {
  // Toggle the drawing mode
  canvas.isDrawingMode = !canvas.isDrawingMode;

  if (canvas.isDrawingMode) {
    // Change the button icon and text to "Stop Drawing"
    drawingModeButton.innerHTML = '<i class="fa fa-stop"></i> '; // Stop icon
    // Show the color picker and width slider
    colorPicker.style.display = 'block';
    widthSlider.style.display = 'block';
    colorPickerLabel.style.display = 'block';
    widthSliderLabel.style.display = 'block';
    drawingTable.style.display = 'block';

    // Set the drawing options
    canvas.freeDrawingBrush.color = colorPicker.value;
    canvas.freeDrawingBrush.width = parseInt(widthSlider.value);
    canvas.freeDrawingBrush.dirty = true;
    canvas.renderAll();
    saveState();
  } else {
    // Change the button icon and text to "Start Drawing"
    drawingModeButton.innerHTML = '<i class="fa fa-pencil"></i> '; // Pencil icon
    // Hide the color picker and width slider
    colorPicker.style.display = 'none';
    widthSlider.style.display = 'none';
    colorPickerLabel.style.display = 'none';
    widthSliderLabel.style.display = 'none';
    drawingTable.style.display = 'none';

  }
});


// end free drawing

// Function to resize selected object by scaling
function resizePlus() {
            var activeObject = canvas.getActiveObject();
            if (activeObject) {
                activeObject.scaleX *= 1.1;
                activeObject.scaleY *= 1.1;
                canvas.renderAll();
                saveState();
            }
        }

        function resizeMinus() {
            var activeObject = canvas.getActiveObject();
            if (activeObject) {
                activeObject.scaleX *= 0.9;
                activeObject.scaleY *= 0.9;
                canvas.renderAll();
                saveState();
            }
        }

        function rotate() {
            var activeObject = canvas.getActiveObject();
            if (activeObject) {
                activeObject.rotate(activeObject.angle + 45);
                canvas.renderAll();
                saveState();
            }
        }


        $(document).ready(function() {
            var line, isDown;
            var mode = "select"; // Default mode
            var lineColor = '#ff0000'; // Default color
            var lineWidth = 5; // Default width

            $("#draw").click(function(){
                if (mode === "draw") {
                    mode = "select";
                    canvas.selection = true;
                    canvas.isDrawingMode = false;
                    $("#draw").html('<i class="fa fa-minus" style="transform: rotate(120deg);"></i>');
                    $("#canvas-container").removeClass('draw-cursor');
                    $("#controls").hide(); // Hide controls
                } else {
                    mode = "draw";
                    canvas.selection = false;
                    canvas.isDrawingMode = false;
                    $("#draw").html('<i class="fa fa-stop"></i>');
                    $("#canvas-container").addClass('draw-cursor');
                    $("#controls").show(); // Show controls
                }
            });

            $("#lineColor").change(function(){
                lineColor = $(this).val();
            });

            $("#lineWidth").change(function(){
                lineWidth = $(this).val();
            });

            canvas.on('mouse:down', function(o){
                if (mode === "draw") {
                    isDown = true;
                    var pointer = canvas.getPointer(o.e);
                    var points = [pointer.x, pointer.y, pointer.x, pointer.y];
                    line = new fabric.Line(points, {
                        strokeWidth: lineWidth,
                        fill: lineColor,
                        stroke: lineColor,
                        originX: 'center',
                        originY: 'center',
                    });
                    canvas.add(line);
                }
            });

            canvas.on('mouse:move', function(o){
                if (mode === "draw" && isDown) {
                    var pointer = canvas.getPointer(o.e);
                    line.set({ x2: pointer.x, y2: pointer.y });
                    canvas.renderAll();
                    saveState();

                }
            });

            canvas.on('mouse:up', function(o){
                if (mode === "draw") {
                    isDown = false;
                }
            });


        });





            var cropper;
            var cropImageElement = document.getElementById('cropImage');

            function uploadLogo(event) {
                var file = event.target.files[0];
                if (file) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        cropImageElement.src = e.target.result;
                        $('#cropModal').modal('show');

                        // Destroy previous cropper if it exists
                        if (cropper) {
                            cropper.destroy();
                        }

                        // Initialize cropper
                        cropper = new Cropper(cropImageElement, {
                            aspectRatio: NaN, // Free aspect ratio
                            viewMode: 1,
                            autoCropArea: 1,
                            responsive: true,
                            background: false,
                            zoomable: true
                        });
                    };
                    reader.readAsDataURL(file);
                }
            }

            document.getElementById('cropImageButton').addEventListener('click', function () {
                var canvasCrop = cropper.getCroppedCanvas();
                var croppedImage = canvasCrop.toDataURL('image/png');

                var imgElement = new Image();
                imgElement.src = croppedImage;

                imgElement.onload = function () {
                    var imgInstance = new fabric.Image(imgElement, {
                        left: 100,
                        top: 100,
                        angle: 0,
                        opacity: 1
                    });

                    if (canvas instanceof fabric.Canvas) {
                        canvas.add(imgInstance);
                        canvas.setActiveObject(imgInstance);
                        canvas.renderAll();
                        saveState();

                    } else {
                        console.error('Canvas instance is not valid.');
                    }

                    $('#cropModal').modal('hide');
                };
            });

            $('#cropModal').on('hidden.bs.modal', function () {
                var fileInput = document.getElementById('ownlogo');
            });  



            function clearCanvas() {
                canvas.clear();
                canvas.renderAll();
                saveState();

            }

            // Attach clearCanvas function to the button click event
            document.getElementById('clearCanvasButton').addEventListener('click', clearCanvas);




            // Add event listener to option images
        document.querySelectorAll('.optionImage').forEach(function(img) {
            img.addEventListener('click', function() {
                var imgSrc = this.src;

                // Set the image source for the <img> element
                document.getElementById('tshirtFacing').src = imgSrc;

                // Clear the canvas
                canvas.clear();
                canvas.renderAll();
                saveState();

            });
        });

    </script>


<script>



function alignCenterTop() {
    var activeObject = canvas.getActiveObject();
    if (activeObject) {
        var canvasWidth = canvas.getWidth();
        var canvasHeight = canvas.getHeight();
        activeObject.set({
            left: (canvasWidth - activeObject.getScaledWidth()) / 2,
            top: 0
        });
        activeObject.setCoords();
        canvas.renderAll();
        saveState();

    }
}

function alignCenterBottom() {
    var activeObject = canvas.getActiveObject();
    if (activeObject) {
        var canvasWidth = canvas.getWidth();
        var canvasHeight = canvas.getHeight();
        activeObject.set({
            left: (canvasWidth - activeObject.getScaledWidth()) / 2,
            top: canvasHeight - activeObject.getScaledHeight()
        });
        activeObject.setCoords();
        canvas.renderAll();
        saveState();

    }
}

function alignTopLeft() {
    var activeObject = canvas.getActiveObject();
    if (activeObject) {
        activeObject.set({ left: 0, top: 0 });
        activeObject.setCoords();
        canvas.renderAll();
        saveState();

    }
}

function alignTopRight() {
    var activeObject = canvas.getActiveObject();
    if (activeObject) {
        var canvasWidth = canvas.getWidth();
        activeObject.set({ left: canvasWidth - activeObject.getScaledWidth(), top: 0 });
        activeObject.setCoords();
        canvas.renderAll();
        saveState();

    }
}

function alignBottomLeft() {
    var activeObject = canvas.getActiveObject();
    if (activeObject) {
        var canvasHeight = canvas.getHeight();
        activeObject.set({ left: 0, top: canvasHeight - activeObject.getScaledHeight() });
        activeObject.setCoords();
        canvas.renderAll();
        saveState();

    }
}

function alignBottomRight() {
    var activeObject = canvas.getActiveObject();
    if (activeObject) {
        var canvasWidth = canvas.getWidth();
        var canvasHeight = canvas.getHeight();
        activeObject.set({
            left: canvasWidth - activeObject.getScaledWidth(),
            top: canvasHeight - activeObject.getScaledHeight()
        });
        activeObject.setCoords();
        canvas.renderAll();
        saveState();

    }
}

function alignCenterBoth() {
    var activeObject = canvas.getActiveObject();
    if (activeObject) {
        var canvasWidth = canvas.getWidth();
        var canvasHeight = canvas.getHeight();
        var objectWidth = activeObject.getScaledWidth();
        var objectHeight = activeObject.getScaledHeight();

        activeObject.set({
            left: (canvasWidth - objectWidth) / 2,
            top: (canvasHeight - objectHeight) / 2
        });
        activeObject.setCoords();
        canvas.renderAll();
        saveState();

    }
}

document.getElementById('align-center-top').addEventListener('click', alignCenterTop);
document.getElementById('align-center-bottom').addEventListener('click', alignCenterBottom);
document.getElementById('align-top-left').addEventListener('click', alignTopLeft);
document.getElementById('align-top-right').addEventListener('click', alignTopRight);
document.getElementById('align-bottom-left').addEventListener('click', alignBottomLeft);
document.getElementById('align-bottom-right').addEventListener('click', alignBottomRight);
document.getElementById('align-center-both').addEventListener('click', alignCenterBoth);






// =======================


document.addEventListener('DOMContentLoaded', function() {
    // var pages = [
    //     { bgGradient: null, bgColor: null, bgImage : null },
    //     { bgGradient: null, bgColor: null, bgImage : null },
    //     { bgGradient: null, bgColor: null, bgImage : null },
    //     { bgGradient: null, bgColor: null, bgImage : null },
    //     { bgGradient: null, bgColor: null, bgImage : null }
    // ];

    var pages = [
        { bgGradient: null, bgColor: null, bgImage: null, bgPositionX: '50%', bgPositionY: '50%' },
        { bgGradient: null, bgColor: null, bgImage: null, bgPositionX: '50%', bgPositionY: '50%' },
        { bgGradient: null, bgColor: null, bgImage: null, bgPositionX: '50%', bgPositionY: '50%' },
        { bgGradient: null, bgColor: null, bgImage: null, bgPositionX: '50%', bgPositionY: '50%' },
        { bgGradient: null, bgColor: null, bgImage: null, bgPositionX: '50%', bgPositionY: '50%' }
    ];


    var currentPage = 0;
    var bgImage = null;
    var bgImagePreviewContainer = document.getElementById('bgImagePreviewContainer');
    var bgImagePositionControls = document.getElementById('bgImagePositionControls');
    let posX = 0;
    let posY = 0;
    let scale = 1;
    let rotation = 0;
    let isBgRepeat = false;


    function updateBackgroundRepeat() {
    const shirtDiv = document.getElementById('shirtDiv');
    shirtDiv.style.backgroundRepeat = isBgRepeat ? 'repeat' : 'no-repeat';
}

// Event listener for background repeat toggle
document.getElementById('bgRepeatToggle').addEventListener('change', function(event) {
    isBgRepeat = event.target.checked;
    updateBackgroundRepeat();
});
updateBackgroundRepeat();





    function toggleColorOptions() {
        var colorType = document.querySelector('input[name="colorType"]:checked').value;
        var plainColorOptions = document.getElementById('plainColorOptions');
        var gradientColorOptions = document.getElementById('gradientColorOptions');

        if (colorType === 'plain') {
            plainColorOptions.style.display = 'block';
            gradientColorOptions.style.display = 'none';
        } else {
            plainColorOptions.style.display = 'none';
            gradientColorOptions.style.display = 'block';
        }
    }

    function toggleDegreeInput() {
        var direction = document.getElementById('gradientDirection').value;
        var degreeInputContainer = document.getElementById('degreeInputContainer');

        if (direction === 'custom') {
            degreeInputContainer.style.display = 'block';
        } else {
            degreeInputContainer.style.display = 'none';
        }
    }

    function updateGradientColorInputs() {
        var numColors = parseInt(document.getElementById('numGradientColors').value);
        var gradientColorInputs = document.getElementById('gradientColorInputs');

        // Clear current inputs
        gradientColorInputs.innerHTML = '';

        // Add start color
        gradientColorInputs.appendChild(createColorInput('gradientStart', 'Start Color', '#ffffff'));

        // Add middle colors based on selected number
        for (var i = 1; i <= numColors - 2; i++) {
            gradientColorInputs.appendChild(createColorInput(`gradientMid${i}`, `Mid Color ${i}`, '#888888'));
        }

        // Add end color
        gradientColorInputs.appendChild(createColorInput('gradientEnd', 'End Color', '#1f1e1e'));

        // Add event listeners for the new inputs
        document.querySelectorAll('.gradient-color-input').forEach(function(input) {
            input.addEventListener('input', applyGradientColor);
        });
    }

    function createColorInput(id, labelText, defaultValue) {
        var container = document.createElement('div');
        var label = document.createElement('label');
        var input = document.createElement('input');

        label.setAttribute('for', id);
        label.textContent = labelText;

        input.setAttribute('type', 'color');
        input.setAttribute('class', 'form-control gradient-color-input');
        input.setAttribute('id', id);
        input.setAttribute('name', id);
        input.setAttribute('value', defaultValue);

        container.appendChild(label);
        container.appendChild(input);

        return container;
    }

    function applyPlainColor(event) {
        if (document.querySelector('input[name="colorType"]:checked').value === 'plain') {
            var color = event.target.style.backgroundColor || event.target.getAttribute('title');
            if (color && color !== 'rgba(0, 0, 0, 0)') {
                var shirtDiv = document.getElementById('shirtDiv');
                shirtDiv.style.backgroundColor = color;
                shirtDiv.style.backgroundImage = ''; // Clear any gradient if plain color is selected

                // Save the background color for the current page
                pages[currentPage].bgGradient = null; // Clear any gradient
                pages[currentPage].bgColor = color;
            }
        }
    }

    function applyGradientColor() {
        if (document.querySelector('input[name="colorType"]:checked').value === 'gradient') {
            var gradientType = document.getElementById('gradientType').value;
            var direction = document.getElementById('gradientDirection').value;
            var colors = [];

            document.querySelectorAll('.gradient-color-input').forEach(function(input) {
                colors.push(input.value);
            });

            if (direction === 'custom') {
                var degree = document.getElementById('gradientDegree').value;
                direction = `${degree}deg`;
            }

            var gradient = '';

            if (gradientType === 'linear') {
                gradient = `linear-gradient(${direction}, ${colors.join(', ')})`;
            } else if (gradientType === 'radial') {
                gradient = `radial-gradient(circle, ${colors.join(', ')})`;
            }

            var shirtDiv = document.getElementById('shirtDiv');
            shirtDiv.style.backgroundImage = gradient;
            shirtDiv.style.backgroundColor = ''; // Clear plain color if gradient is selected

            // Save the gradient for the current page
            pages[currentPage].bgGradient = gradient;
            pages[currentPage].bgColor = null; // Clear any plain color
        }
    }

//     document.getElementById('uploadBgImage').addEventListener('click', function() {
//   var fileInput = document.getElementById('bgImage');
//   var file = fileInput.files[0];
//   var reader = new FileReader();

//   reader.onload = function(event) {
//     bgImage = event.target.result;
//     var shirtDiv = document.getElementById('shirtDiv');
//     shirtDiv.style.backgroundImage = `url(${bgImage})`;
//     shirtDiv.style.backgroundSize = 'cover';
//     shirtDiv.style.backgroundPosition = 'center';

//     // Save the background image for the current page
//     pages[currentPage].bgImage = bgImage;
//   };

//   reader.readAsDataURL(file);
// });
document.getElementById('uploadBgImage').addEventListener('click', function() {
        var fileInput = document.getElementById('bgImage');
        var file = fileInput.files[0];
        var reader = new FileReader();

        reader.onload = function(event) {
            bgImage = event.target.result;

            // Create a preview element for the uploaded image
            var imgPreview = document.createElement('img');
            imgPreview.src = bgImage;
            imgPreview.classList.add('img-thumbnail');
            imgPreview.style.maxWidth = '100px';
            imgPreview.style.margin = '5px';
            imgPreview.addEventListener('click', function() {
                // Set this image as the background
                pages[currentPage].bgImage = bgImage;
                updateBackgroundImage();
            });

            // Add the preview to the container
            bgImagePreviewContainer.appendChild(imgPreview);

            // Show position controls
            bgImagePositionControls.style.display = 'block';
        };

        reader.readAsDataURL(file);
    });

    document.getElementById('bgImagePositionX').addEventListener('input', function() {
        var positionX = this.value + '%';
        pages[currentPage].bgPositionX = positionX;
        updateBackgroundImage();
    });

    document.getElementById('bgImagePositionY').addEventListener('input', function() {
        var positionY = this.value + '%';
        pages[currentPage].bgPositionY = positionY;
        updateBackgroundImage();
    });

    function updateBackgroundImageStyles() {
    const shirtDiv = document.getElementById('shirtDiv');
    shirtDiv.style.backgroundPosition = `${posX}px ${posY}px`;
    shirtDiv.style.backgroundSize = `${scale * 100}%`;
    shirtDiv.style.transform = `rotate(${rotation}deg)`;
}
// Event listeners for position controls
document.getElementById('moveUp').addEventListener('click', function() {
    posY -= 10;
    updateBackgroundImageStyles();
});

document.getElementById('moveDown').addEventListener('click', function() {
    posY += 10;
    updateBackgroundImageStyles();
});

document.getElementById('moveLeft').addEventListener('click', function() {
    posX -= 10;
    updateBackgroundImageStyles();
});

document.getElementById('moveRight').addEventListener('click', function() {
    posX += 10;
    updateBackgroundImageStyles();
});

// Event listener for scale control
document.getElementById('scaleRange').addEventListener('input', function(event) {
    scale = event.target.value;
    updateBackgroundImageStyles();
});

// Event listener for rotate control
document.getElementById('rotateRange').addEventListener('input', function(event) {
    rotation = event.target.value;
    updateBackgroundImageStyles();
});
function updateBackgroundImage() {
        var shirtDiv = document.getElementById('shirtDiv');
        shirtDiv.style.backgroundImage = `url(${bgImage})`;
        shirtDiv.style.backgroundSize = 'cover';
        shirtDiv.style.backgroundPositionX = pages[currentPage].bgPositionX;
        shirtDiv.style.backgroundPositionY = pages[currentPage].bgPositionY;
    }



    // function loadPage(pageIndex) {
    //     saveCurrentPage(); // Save the current page before switching
    //     currentPage = pageIndex;

    //     var shirtDiv = document.getElementById('shirtDiv');

    //     if (pages[pageIndex].bgGradient) {
    //         shirtDiv.style.backgroundImage = pages[pageIndex].bgGradient;
    //         shirtDiv.style.backgroundColor = ''; // Clear plain color
    //     } else {
    //         shirtDiv.style.backgroundColor = pages[pageIndex].bgColor || "#ffffff"; // Default to white if no color is set
    //         shirtDiv.style.backgroundImage = ''; // Clear gradient if plain color is selected
    //     }

    //     // Clear and restore the canvas
    //     canvas.clear();
    //     canvas.loadFromJSON(pages[pageIndex].canvasState, function() {
    //         canvas.renderAll();
    //         saveState();


    //         // Ensure all objects are selectable
    //         canvas.forEachObject(function(obj) {
    //             obj.set('selectable', true);
    //         });
    //         canvas.renderAll();
    //         saveState();

    //     });
    // }

//     function loadPage(pageIndex) {
//   saveCurrentPage(); // Save the current page before switching
//   currentPage = pageIndex;

//   var shirtDiv = document.getElementById('shirtDiv');

//   if (pages[pageIndex].bgGradient) {
//     shirtDiv.style.backgroundImage = pages[pageIndex].bgGradient;
//     shirtDiv.style.backgroundColor = ''; // Clear plain color
//   } else if (pages[pageIndex].bgColor) {
//     shirtDiv.style.backgroundColor = pages[pageIndex].bgColor || "#ffffff"; // Default to white if no color is set
//     shirtDiv.style.backgroundImage = ''; // Clear gradient if plain color is selected
//   } else if (pages[pageIndex].bgImage) {
//     shirtDiv.style.backgroundImage = `url(${pages[pageIndex].bgImage})`;
//     shirtDiv.style.backgroundSize = 'cover';
//     shirtDiv.style.backgroundPosition = 'center';
//   }

//   // Clear and restore the canvas
//   canvas.clear();
//   canvas.loadFromJSON(pages[pageIndex].canvasState, function() {
//     canvas.renderAll();
//     saveState();

//     // Ensure all objects are selectable
//     canvas.forEachObject(function(obj) {
//       obj.set('selectable', true);
//     });
//     canvas.renderAll();
//     saveState();
//   });
// }

function loadPage(pageIndex) {
        saveCurrentPage(); // Save the current page before switching
        currentPage = pageIndex;

        var shirtDiv = document.getElementById('shirtDiv');

        if (pages[pageIndex].bgGradient) {
            shirtDiv.style.backgroundImage = pages[pageIndex].bgGradient;
            shirtDiv.style.backgroundColor = ''; // Clear plain color
        } else if (pages[pageIndex].bgColor) {
            shirtDiv.style.backgroundColor = pages[pageIndex].bgColor || "#ffffff"; // Default to white if no color is set
            shirtDiv.style.backgroundImage = ''; // Clear gradient if plain color is selected
        } else if (pages[pageIndex].bgImage) {
            bgImage = pages[pageIndex].bgImage;
            shirtDiv.style.backgroundImage = `url(${pages[pageIndex].bgImage})`;
            shirtDiv.style.backgroundSize = 'cover';
            shirtDiv.style.backgroundPositionX = pages[pageIndex].bgPositionX;
            shirtDiv.style.backgroundPositionY = pages[pageIndex].bgPositionY;
        }

        // Clear and restore the canvas
        canvas.clear();
        canvas.loadFromJSON(pages[pageIndex].canvasState, function() {
            canvas.renderAll();
            saveState();

            // Ensure all objects are selectable
            canvas.forEachObject(function(obj) {
                obj.set('selectable', true);
            });
            canvas.renderAll();
            saveState();
        });
    }

    document.querySelectorAll('input[name="colorType"]').forEach(function(radio) {
        radio.addEventListener('change', toggleColorOptions);
    });

    document.querySelectorAll('.color-preview').forEach(function(item) {
        item.addEventListener('click', applyPlainColor);
    });

    document.getElementById('gradientType').addEventListener('change', applyGradientColor);
    document.getElementById('numGradientColors').addEventListener('change', function() {
        updateGradientColorInputs();
        applyGradientColor();
    });
    document.getElementById('gradientDirection').addEventListener('change', function() {
        toggleDegreeInput();
        applyGradientColor();
    });
    document.getElementById('gradientDegree').addEventListener('input', applyGradientColor);






    function setBackgroundImage(url) {
    const shirtDiv = document.getElementById('shirtDiv');
    shirtDiv.style.backgroundImage = `url('${url}')`;
    shirtDiv.style.backgroundSize = 'cover';  // Adjust background size as needed
    shirtDiv.style.backgroundPosition = 'center';  // Center the background
    shirtDiv.style.backgroundRepeat = isBgRepeat ? 'repeat' : 'no-repeat'; // Apply repeat setting
}
document.querySelectorAll('.builtin-bg').forEach(img => {
    img.addEventListener('click', function() {
        setBackgroundImage(this.src);
    });
});

    // Initialize on page load
    toggleColorOptions();
    toggleDegreeInput();
    updateGradientColorInputs();
    loadPage(currentPage);
});




// ==============================



var CM_TO_PX = 96 / 2.54; // Pixels per cm
var INCH_TO_PX = 96;      // Pixels per inch





// Get the width and height inputs, unit dropdowns, and apply button
var widthInput = document.getElementById('width-input');
var heightInput = document.getElementById('height-input');
var widthUnit = document.getElementById('width-unit');
var heightUnit = document.getElementById('height-unit');
var applyButton = document.getElementById('apply-dimensions');

// Function to convert from pixels to other units
function convertFromPixels(value, unit) {
    if (unit === 'cm') {
        return value / CM_TO_PX;
    } else if (unit === 'in') {
        return value / INCH_TO_PX;
    } else {
        return value; // Default to pixels
    }
}

// Function to convert to pixels from other units
function convertToPixels(value, unit) {
    if (unit === 'cm') {
        return value * CM_TO_PX;
    } else if (unit === 'in') {
        return value * INCH_TO_PX;
    } else {
        return value; // Default to pixels
    }
}

// Function to update the input fields with the object's current size in the selected unit
function updateInputs(object) {
    if (object) {
        var currentWidthPx = object.getScaledWidth();
        var currentHeightPx = object.getScaledHeight();

        // Convert the current dimensions to the selected units
        widthInput.value = convertFromPixels(currentWidthPx, widthUnit.value).toFixed(2);
        heightInput.value = convertFromPixels(currentHeightPx, heightUnit.value).toFixed(2);
    }
}

// Add event listeners to the unit dropdowns to update the displayed dimensions when units change
widthUnit.addEventListener('change', function() {
    updateInputs(canvas.getActiveObject());
});

heightUnit.addEventListener('change', function() {
    updateInputs(canvas.getActiveObject());
});

// Function to handle object selection
function onObjectSelected(object) {
    updateInputs(object); // Immediately update inputs with selected object's dimensions
}

// Add an event listener to the apply button
applyButton.addEventListener('click', function() {
    var activeObject = canvas.getActiveObject();
    if (activeObject) {
        var newWidth = convertToPixels(parseFloat(widthInput.value), widthUnit.value);
        var newHeight = convertToPixels(parseFloat(heightInput.value), heightUnit.value);

        activeObject.set({
            scaleX: newWidth / activeObject.width,
            scaleY: newHeight / activeObject.height
        });

        activeObject.setCoords(); // Update the coordinates for correct selection
        canvas.renderAll();
        saveState();

    }
});

// Clear input fields when selection is cleared
function onSelectedCleared() {
    widthInput.value = '';
    heightInput.value = '';
}

</script>
</body>
</html>

